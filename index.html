<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#1f2430"/>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>Wordle</title>
  <style>
    :root {
      --bg:#141820; --panel:#1f2430; --tile:#2a2e38; --tile-border:#3a3f4d;
      --text:#eaeef7; --muted:#8e97a8; --green:#6aaa64; --yellow:#c9b458; --gray:#3a3a3c;
      --accent:#6aa0ff;
    }
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body {
      margin:0; background:var(--bg); color:var(--text); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .app { width: min(520px, 100%); }
    header {
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 4px 12px; border-bottom:1px solid #242938; margin-bottom:12px;
    }
    h1 { margin:0; font-size:22px; letter-spacing:3px; text-transform:uppercase; }
    button.icon { background:transparent; border:1px solid #2b3040; color:var(--text); border-radius:10px; padding:6px 10px; cursor:pointer; }
    .board { display:grid; grid-template-rows: repeat(6, 1fr); gap:8px; padding:8px; }
    .row { display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; }
    .tile {
      height:58px; display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size:24px; text-transform:uppercase;
      border-radius:10px; background:var(--tile); border:1px solid var(--tile-border);
      transition: transform .07s ease, background .2s;
    }
    .tile.reveal { transform: scale(1.02); }
    .kbs { display:flex; flex-direction:column; gap:8px; padding:8px; align-items:center; }
    .kb-row { display:flex; gap:6px; justify-content:center; }
    .key {
      background:#2c3140; color:var(--text); border:none; padding:12px 10px;
      border-radius:10px; font-weight:600; cursor:pointer; min-width:30px;
      text-transform:uppercase;
    }
    .key.wide { min-width:64px; font-size:14px; }
    .k-green { background: var(--green) !important; }
    .k-yellow { background: var(--yellow) !important; color:#111 !important; }
    .k-gray { background: var(--gray) !important; }
    .status { text-align:center; color:var(--muted); padding:4px 0 8px; min-height:20px; }
    .footer { display:flex; gap:10px; justify-content:space-between; align-items:center; padding:8px; color:var(--muted); font-size:12px; }
    .stats { display:flex; gap:12px; align-items:center; }
    .stat { background:#1d2230; border:1px solid #2a2f3d; padding:8px 10px; border-radius:10px; }
    .toast {
      position:fixed; top:16px; left:50%; transform:translateX(-50%);
      background:#1d2230; border:1px solid #2a2f3d; padding:10px 14px; border-radius:10px; color:var(--text);
      opacity:0; pointer-events:none; transition:opacity .25s;
    }
    .toast.show { opacity:1; }
    a { color:var(--accent); text-decoration:none; }

    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; }
    .modal.hidden { display:none; }
    .modal-box { background:var(--panel); padding:20px; border-radius:10px; text-align:center; max-width:300px; }
    .modal-box button { margin-top:10px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>WORDLE</h1>
      <div style="display:flex; gap:8px;">
        <button class="icon" id="btn-new">New</button>
        <button class="icon" id="btn-share">Share</button>
        <button class="icon" id="btn-free">Free Play</button>
        <button class="icon" id="btn-install" style="display:none;">Install</button>
      </div>
    </header>

    <div class="status" id="status"></div>

    <div class="board" id="board"></div>

    <div class="kbs" id="kbs"></div>

    <div class="footer">
      <div class="stats">
        <div class="stat"><span id="s-played">0</span> played</div>
        <div class="stat"><span id="s-win">0</span>% win</div>
        <div class="stat">streak <span id="s-streak">0</span></div>
      </div>
      <div><a href="https://www.biblegateway.com/passage/?search=John%203%3A16&version=NIV" style="text-decoration: none; color: white;" target="_blank">Jesus Saves</a></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <div class="modal hidden" id="intro-modal">
    <div class="modal-box">
      <h2>Welcome to Wordle</h2>
      <p>Guess the word in 6 tries. A new word appears every day.</p>
      <button id="intro-start">Start</button>
    </div>
  </div>

  <div class="modal hidden" id="win-modal">
    <div class="modal-box">
      <h2>Congratulations!</h2>
      <p>You solved the word. Share with friends!</p>
      <button id="win-share">Share</button>
      <button id="win-close">Close</button>
    </div>
  </div>

  <div class="modal hidden" id="lose-modal">
    <div class="modal-box">
      <h2>Game Over</h2>
      <p>The word was <span id="lose-word"></span>.</p>
      <button id="lose-share">Share</button>
      <button id="lose-close">Close</button>
    </div>
  </div>

  <div class="modal hidden" id="free-modal">
    <div class="modal-box">
      <h2>Free Play</h2>
      <p>Words are picked at random. Free Play sharpens your Wordle skills.</p>
      <button id="free-start">Start</button>
      <button id="free-cancel">Cancel</button>
    </div>
  </div>

  <script>
    // --- PWA install prompt handling ---
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('btn-install').style.display = 'inline-block';
    });
    document.getElementById('btn-install').addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      document.getElementById('btn-install').style.display = 'none';
    });

    // --- Service Worker ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }

    // --- Game State ---
    const ANSWERS = [
"abate","abbey","abler","about","adage","adapt","adept","adieu","adobe","adorn","adroit","aeons","aegis","affix","afire","agape","agate","agent","agile","aglow","agora","agree",
"aisle","album","alder","alert","algae","alias","alibi","aline","alive","allay","alley","allot","allow","alloy","aloft","alone","along","aloof","aloud","alpha","altar","alter",
"amble","amend","amide","amigo","amine","amity","among","amuse","angel","anger","angle","angst","anode","antic","anvil","aorta","apace","apnea","apple","apply","apron","aptly",
"arbor","ardor","arena","argue","arise","aroma","array","arrow","arson","artsy","ascot","ashen","aside","askew","aspic","assay","asset","aster","atlas","atoll","atomy","attar",
"attic","audit","augur","aural","auric","avail","avert","avian","avion","avoid","await","awake","award","aware","awash","awoke","axiom","azide","azure",
"bacon","badge","badly","bagel","baili","baker","baler","balmy","banal","banjo","barge","basil","basin","basis","batch","bathe","baton","bayou","beach","beady","beard","beast",
"began","begat","begin","begun","being","belay","belie","belle","below","bench","beret","berry","berth","beset","betel","bevel","bezel","bialy","bible","biddy","binge","bingo",
"biome","bipod","birch","birth","bison","black","blade","blame","bland","blank","blare","blast","blaze","bleak","bleat","bleed","bleep","blend","bless","blimp","blind","blink",
"bliss","blitz","bloat","block","bloke","blond","blood","bloom","blown","bluer","bluff","blunt","blurb","blurt","blush","board","boast","bobby","boggy","bogus","boils","bolus",
"bongo","bonus","booth","boost","booth","borax","botch","bough","boule","bound","bovid","bowel","boxer","brace","braid","brain","brake","brand","brash","brass","brave","bravo",
"brawl","brawn","bread","break","breed","briar","bribe","brick","brief","brine","bring","brink","briny","brisk","broad","broil","broke","brood","brook","broom","broth","brown",
"bruit","brunt","brush","brute","bryon","buddy","budge","bugle","build","built","bulge","bulky","bully","bunch","bunny","burly","burnt","burse","burst","bused","bushy","busts",
"butte","buyer","bylaw",
"cabal","cable","cacao","cache","cacti","cadet","cagey","cairn","cajun","calix","calla","calms","calyx","camel","cameo","canal","candy","canny","canon","canto","caput","carat",
"carbo","cardi","cargo","carol","carom","carve","caste","catch","cater","cavil","cedar","cello","cense","chafe","chaff","chain","chair","chalk","champ","chant","chaos","chard",
"charm","chart","chasm","chase","chasm","chess","chide","chief","child","chili","chime","china","chirp","chive","choir","choke","chord","chore","chose","chute","cinch","civic",
"civil","clack","claim","clair","clamp","clang","clank","clash","clasp","class","clean","clear","cleat","cleft","clerk","click","cliff","climb","cline","cling","clink","cloak",
"clock","clone","close","cloth","cloud","clout","clove","clown","cloze","cluck","clued","clump","clung","clutch",
"coach","coast","cobalt","cobol","cobra","cocci","cocoa","codex","coder","codon","cohere","cohos","coils","coinx","coker","colic","colon","color","colts","comet","comma",
"comfy","comic","comma","conch","condo","conic","conga","conic","cooks","copper","coral","corgi","corky","corps","corse","couch","cough","could","coven","cover","covet","covid",
"cower","coyly","cozen","crack","craft","cramp","crane","crank","crash","crass","crate","crave","crawl","craze","crazy","cream","credo","creek","creep","creme","crepe","crept",
"cress","crest","crews","cribs","crick","cried","crier","crime","crimp","crisp","croak","crock","crone","crony","crook","croon","cross","croup","crowd","crown","crude","cruel",
"crumb","crush","crust","crypt","cubic","cubit","cumin","cupid","curio","curly","curry","curve","cushy","cuter","cutie","cyber","cycle","cynic",
"daily","dairy","daisy","dally","dance","dandy","datum","dealt","death","debut","decaf","decay","decry","defer","deign","deism","deist","delta","delve","demon","demur","dense",
"depot","depth","derby","desks","detox","deuce","devil","devon","diary","dicey","dicot","diety","dimen","dinar","dingy","diode","dirty","disco","dishy","ditch","ditto","ditty",
"diver","dizzy","dodge","doily","doing","dolor","donor","doped","doses","doubt","dough","douse","dowel","dowry","dozen","draft","drain","drake","drama","drank","drape","drawl",
"drawn","dread","dream","dregs","dress","dried","drier","drift","drill","drink","drive","droit","droll","drone","drool","droop","dross","drove","drown","druid","drums","dryer",
"ducal","duchy","duets","dully","dunce","dunno","duomo","duped","dural","dusky","dusty","dutch","dwell","dwind","dying",
"eager","eagle","early","earth","easel","eaten","eater","ebony","edict","edify","eerie","egret","eight","eject","eland","elbow","elder","elect","elegy","elfin","elide","elite",
"elope","elude","elute","elven","email","embed","ember","emend","empty","enact","endow","endue","enemy","enjoy","ennui","ensue","enter","entry","envoy","epoxy","equal","equip",
"erase","erect","ergot","erode","error","erupt","essay","ester","ethic","ethos","ethyl","etude","evade","event","evert","evict","evoke","exact","exalt","exert","exile","exist",
"expel","extol","extra","exult",
"fable","facet","faint","fairy","faith","false","fancy","fatal","fatty","fault","fauna","favor","feast","fecal","feces","feign","feint","fella","felon","femme","femur","fence",
"feral","ferry","fetal","fetch","fetid","fetus","fever","fiber","fibre","ficus","field","fiend","fifth","fifty","fight","filmy","filth","final","finch","finer","finger","finis",
"finch","fired","firth","fjord","flair","flame","flank","flare","flash","flask","fleck","flesh","flick","fling","flint","flirt","float","flock","flood","floor","flora","flour",
"flout","flown","fluid","fluke","flume","flung","flute","flyer","foamy","focal","focus","folio","folks","folly","foray","force","forge","forgo","forte","forth","forty","forum",
"found","fount","foxed","foyer","frail","frame","franc","frank","frats","fraud","freak","freed","freer","fresh","friar","frill","frisk","frock","frond","front","frost","froth",
"frown","fryer","fugal","fugue","fuzzy",
"gable","gaffe","gaily","gains","gamer","gamma","gamut","gassy","gaudy","gauge","gaunt","gauze","gavel","gawky","jazzy","gears","geeky","geese","genie","genom","genre","genus",
"geode","germs","ghost","ghoul","giant","giddy","girth","given","giver","glade","gland","glare","glass","glaze","gleam","glean","glide","glint","gloat","globe","gloom","glory",
"gloss","glove","glyph","gnash","gnome","goads","gonna","goods","goopy","gorge","gourd","grace","grade","graft","grain","grand","grant","grape","graph","grasp","grass","grate",
"grave","gravy","graze","great","greed","green","greet","grief","grift","grill","grime","grind","gripe","grist","groan","groin","groom","grove","growl","grown","gruff","grump",
"guard","guava","guess","guest","guide","guild","guile","guilt","guise","gulch","gully","gumbo","gummy","gusto","gypsy",
"habit","haiku","hairy","halve","handy","hangs","happy","hardy","harem","harpy","harsh","haste","hasty","hatch","haunt","haven","havoc","hazel","heady","heath","heave","heavy",
"hedge","heist","helix","hello","helms","helot","hempy","heron","hertz","hexed","hider","hiker","hilly","hinge","hippo","hippy","hired","hitch","hiver","hoard","hoary","hobby",
"hobby","hocus","hoist","hokum","holly","homer","honey","honor","hooch","hoofe","hooky","horde","horny","horse","hotel","hound","hours","house","hovel","hover","howdy","human",
"humid","humor","humph","hunch","hurly","hurry","hutch","hydra","hydro","hyena","hymns",
"icier","icily","icing","ideal","ideas","idiom","idiot","idler","idyll","igloo","ileum","ilium","image","impel","imply","inane","inert","infer","ingot","inkle","inlet","inner",
"input","inter","iodic","ionic","irate","irony","islet","issue","itchy","ivory","ixora",
"jazzy","jelly","jerky","jewel","jiffy","jingo","jolly","joust","jubil","judas","juice","juicy","jumbo","jumpy","junta","juror",
"kappa","karma","kayak","kebab","ketch","kiosk","kites","kitty","knack","knead","kneel","knell","knelt","knife","knock","known","koala","kudos",
"label","labor","lacey","lacks","laden","ladle","lager","laity","laird","lance","lanky","lapel","lapse","larch","largo","larva","laser","lasso","lasts","later","latex","laugh",
"laure","lavvy","layer","leach","leafy","leant","learn","lease","ledge","lemon","lemur","leper","learn","level","lever","lexis","liars","libel","licit","lilac","limbo","limen",
"limit","linen","liner","lingo","lipid","lithe","liver","livid","llama","loamy","loath","lobby","local","lofty","logic","login","loins","lolly","loner","loose","loopy","lorry",
"loser","lotus","louse","lousy","loved","lover","lower","lowly","loyal","lucid","lucky","lumen","lumpy","lunar","lunch","lunge","lupus","lurch","lurid","lusty","lyric",
"macro","madam","madly","mafic","magic","magma","maize","major","maker","manga","mange","mango","mania","manor","manse","maple","march","marry","maser","mason","match","mater",
"maths","matte","maybe","mayor","mealy","meant","meaty","mecca","medal","media","medic","melee","melon","mercy","merge","merit","meson","metal","meter","metre","metro","micro",
"midst","might","milky","mimic","miner","minor","minus","mirth","miser","modal","model","modem","modus","moire","moist","molar","moldy","money","month","moral","moron","morph",
"mossy","motif","motor","mould","moult","mound","mount","mourn","mouse","mouth","moved","mover","movie","mower","mucus","muddy","mulch","mummy","munch","mural","murky","mushy",
"music","musky","mussy","musty","myrrh",
"nabob","nacho","nadir","naiad","naive","nanny","nasal","nasty","naval","nears","neath","necro","needy","neigh","nerdy","nerve","never","newer","newly","nexus","nicer","niche",
"nieve","nifty","night","nimbi","ninja","ninth","nitro","noble","nobly","nodes","noise","noisy","nomad","nonce","noose","north","novel","nudge","nurse","nutty",
"oakum","oasis","oaten","obese","occur","ocean","octal","octet","odder","odium","offal","offer","often","ogive","oiled","olive","omega","ombre","omits","onion","onset","oomph",
"opals","opera","opine","optic","orate","orbit","order","organ","oscar","other","otter","ought","ounce","outdo","outgo","ovary","ovate","overt","ovine","ovoid","oxide","ozone",
"pacer","paddy","pagan","paint","palmy","papal","paper","parer","parka","parse","party","patch","patio","patri","pause","pavan","paver","payee","payer","peace","pearl","pecan",
"pedal","peers","penal","penne","peony","perch","peril","perks","perky","perm","perry","pesky","pesto","petal","petri","phase","phage","phone","photo","piano","piece","piety",
"piggy","piker","pilot","pinky","pique","pitch","pivot","pixel","pizza","place","plaid","plain","plait","plane","plank","plant","plate","plead","pleat","plied","plier","plonk",
"plumb","plume","plump","plush","poesy","poets","point","poise","polar","polka","polyp","pooch","poppy","porch","poser","posit","posse","pouch","pound","power","prank","prate",
"prawn","press","price","pride","pried","primo","print","prior","prism","privy","prize","probe","prose","proud","prove","proxy","prude","prune","psalm","pseud","pupil","puree",
"purge","purse","pushy","pylon",
"quack","quaff","quail","quake","qualm","quart","quash","queer","queen","quell","query","quest","queue","quick","quiet","quill","quilt","quint","quirk","quite","quota","quote",
"rabid","racer","radar","radii","radio","radix","rainy","raise","rajah","rally","ramen","ranch","range","rapid","rarer","raspy","ratio","raven","rayon","reach","react","ready",
"realm","rearm","rebar","rebid","rebus","rebut","recap","recon","recto","recut","redeem","refer","refit","regal","rehab","reify","reign","relax","relay","relic","reman","remit",
"renal","renew","repay","repel","reply","repot","rerun","reset","resin","retch","retro","retry","reuse","revel","revue","rhino","rhyme","rider","ridge","rifle","right","rigid",
"rigor","riley","rinse","ripen","riper","riser","risky","rival","river","rivet","roach","roast","robin","robot","rocky","rogue","roily","roman","rooms","roost","roost","roped",
"rosin","rotor","rouge","rough","round","rouse","route","rover","rower","royal","ruler","rumor","runic","rupee","rural","rusty",
"sable","sabre","saber","sabin","sable","savor","sauce","saute","savor","scale","scalp","scamp","scant","scare","scarf","scary","scaup","scene","scent","schwa","scion","scoff",
"scold","scone","scoop","scope","score","scorn","scour","scout","scowl","scrap","scree","screw","scrip","scroll","scrub","scuba","scuff","seams","sepal","sepia","serif","serum",
"serve","setup","seven","sever","sewer","shack","shade","shady","shaft","shake","shale","shall","shame","shape","share","shark","sharp","shave","sheaf","shear","sheen","sheep",
"sheer","sheet","shelf","shell","shewn","shift","shine","shiny","shire","shirk","shoal","shock","shone","shook","shoot","shore","short","shout","shove","shown","showy","shrew",
"shrub","shrug","shunt","shush","shyly","sided","siege","sieve","sight","sigma","silky","silly","since","sinew","singe","siren","sitar","sited","sixth","sixty","skate","skein",
"skies","skiff","skill","skimp","skirt","skulk","skull","skunk","slack","slain","slang","slash","slate","slave","sleek","sleep","sleet","slept","slice","slick","slide","slime",
"slimy","sling","slink","sloop","slope","slosh","sloth","slump","slung","slurp","slush","slyly","smack","small","smart","smash","smear","smell","smelt","smile","smirk","smite",
"smith","smock","smoke","smoky","smote","snack","snafu","snail","snake","snaky","snare","snark","snarl","sneak","sneer","snide","sniff","snipe","snoop","snore","snort","snout",
"snowy","snuck","soapy","sober","soggy","solar","solid","solve","sonar","sonic","sooty","sopor","sores","sound","south","sower","space","spade","spank","spare","spark","spasm",
"spawn","speak","spear","speck","speed","spell","spelt","spend","spent","sperm","spice","spicy","spied","spiel","spike","spiky","spill","spine","spiny","spire","spite","splat",
"split","spoil","spoke","spoof","spook","spool","spoon","sport","spout","spray","spree","sprig","spunk","spurn","spurt","squad","squat","squib","squid","stack","staff","stage",
"stahl","staid","stain","stair","stake","stale","stalk","stall","stamp","stand","stare","stark","start","stash","state","stave","stead","steak","steal","steam","steed","steel",
"steep","steer","stein","stern","stick","stiff","stile","still","stilt","sting","stink","stint","stipe","stirk","stirs","stock","stoic","stoke","stole","stomp","stone","stony",
"stoop","store","stork","storm","story","stout","stove","strap","straw","stray","strew","strip","strop","strum","strut","stuck","study","stuff","stump","stung","stunk","stunt",
"style","suave","sugar","suing","suite","sulky","sully","sumac","sushi","swami","swamp","swarm","swash","swath","sweat","sweep","sweet","swell","swept","swift","swill","swine",
"swing","swirl","swish","swoon","swoop","sword","sworn","synod","syrup",
"table","taboo","tacit","tacky","taffy","taint","taken","tally","talon","tango","taper","tapir","tardy","taunt","tawny","teach","teary","tease","teeth","tempo","tenet","tenor",
"tense","tenth","tenty","tepid","terra","terse","theta","thick","thief","thigh","thing","think","third","thong","thorn","those","three","threw","throb","throw","thrum","thump",
"tidal","tiger","tight","tilde","tiled","tiler","tilth","timid","tinct","tinge","tinge","titan","tithe","title","tizzy","toast","today","token","tolls","tonal","toner","tonga",
"tonic","topic","torch","torso","torte","total","totem","touch","tough","tours","towed","towel","tower","toxic","toxin","trace","track","tract","trade","trail","train","trait",
"tramp","traps","trash","trawl","tread","treat","treks","trend","tress","triad","trial","tribe","trice","trick","tried","trier","triff","trite","trope","trout","trove","truce",
"truly","trump","trunk","truss","trust","truth","tryst","tuber","tulip","tummy","tumor","tuned","tunic","tuple","tutor","twain","twang","tweak","tweed","tweet","twelve","twixt",
"ulcer","ulnae","ultra","umbra","uncle","uncut","under","undue","undid","unfit","unify","union","unite","unity","units","unlit","unmet","unpin","unsay","untie","until","unwed",
"upper","ureas","urged","urine","usage","usher","using","usual","usurp","uteri","utile","utter",
"vague","valet","valid","valor","value","valve","vapid","vapor","varda","vardo","vasty","vault","vaunt","vegan","veins","velar","velum","venal","vendr","venom","venue","verge",
"verse","verve","vesta","vetch","vetoe","vexed","vexer","vicar","vigil","vigor","villa","vinyl","viola","viper","viral","virtu","virus","visas","visit","visor","vista","vital",
"vitro","vivid","vixen","vocab","vocal","vodka","vogue","voice","voila","vomit","voter","vouch","vowel","vulgo",
"wacky","waltz","watch","water","waver","waxen","waxer","weary","weave","wedge","weedy","weigh","weird","welch","welsh","whack","whale","wheat","wheel","whelp","where","which",
"whine","whirl","whisk","white","whole","whoop","whose","widen","wider","widow","width","wield","wight","wince","winch","windy","wiser","wispy","witch","witty","woken","woman",
"women","woody","wooer","wooly","woosh","wordy","works","world","worry","worse","worst","worth","would","wound","woven","wrack","wrath","wreak","wreck","wrest","wring","wrist",
"write","wrong","wrote","wrung","wryly",
"xenon","xeric","xylem",
"yacht","yahoo","yearn","yeast","yodel","yoked","young","yours","youth","yucca","yummy",
"zebra","zesty","zilch","zonal","zombi","zowie"
];
    const ALPH = "qwertyuiopasdfghjklzxcvbnm";
    const ROWS = 6, COLS = 5;

    const $ = (id) => document.getElementById(id);
    const board = $('board'); const kbs = $('kbs'); const status = $('status');
    const toast = $('toast');

    let freePlay = false;
    let target = pickWord();
    let row = 0, col = 0, over = false;
    let grid = Array.from({length: ROWS}, () => Array(COLS).fill(""));
    let meta = Array.from({length: ROWS}, () => Array(COLS).fill(""));
    const stats = loadStats();

    // Build board UI
    function buildBoard() {
      board.innerHTML = "";
      for (let r=0; r<ROWS; r++) {
        const rowEl = document.createElement('div'); rowEl.className = 'row';
        for (let c=0; c<COLS; c++) {
          const t = document.createElement('div'); t.className = 'tile'; t.id = `t-${r}-${c}`;
          rowEl.appendChild(t);
        }
        board.appendChild(rowEl);
      }
    }

    // Keyboard UI
    function buildKeyboard() {
      const rows = ["qwertyuiop","asdfghjkl","⟵zxcvbnm↵"];
      kbs.innerHTML = "";
      for (const r of rows) {
        const d = document.createElement('div'); d.className = 'kb-row';
        for (const ch of r) {
          const b = document.createElement('button');
          b.className = 'key';
          if (ch==='⟵') { b.textContent='⌫'; b.classList.add('wide'); b.onclick = backspace; }
          else if (ch==='↵') { b.textContent='Enter'; b.classList.add('wide'); b.onclick = enter; }
          else { b.textContent = ch; b.onclick = () => add(ch); }
          b.id = `k-${ch}`;
          d.appendChild(b);
        }
        kbs.appendChild(d);
      }
    }

    function pickWord() {
  const start = new Date(new Date().getFullYear(), 0, 0);
  const today = new Date();
  const diff = today - start;
  const day = Math.floor(diff / (1000*60*60*24)); // 1..365
  return ANSWERS[(day - 1) % ANSWERS.length];
}

    function pickRandomWord() {
      return ANSWERS[Math.floor(Math.random()*ANSWERS.length)];
    }

    function draw() {
      for (let r=0; r<ROWS; r++) {
        for (let c=0; c<COLS; c++) {
          const t = $(`t-${r}-${c}`);
          t.textContent = grid[r][c] || "";
          const m = meta[r][c];
          t.style.background = m==='g' ? 'var(--green)' : m==='y' ? 'var(--yellow)' : m==='x' ? 'var(--gray)' : 'var(--tile)';
          t.style.color = m==='y' ? '#111' : 'var(--text)';
        }
      }
    }

    function add(ch) {
      if (over) return;
      if (col < COLS) { grid[row][col++] = ch; draw(); }
    }
    function backspace() {
      if (over) return;
      if (col>0) { grid[row][--col] = ""; draw(); }
    }
    function enter() {
      if (over) return;
      if (col < COLS) { return toastMsg("Not enough letters"); }
      const guess = grid[row].join('');
      if (!isValid(guess)) { return toastMsg("Not in list"); }
      reveal(guess);
    }
    function isValid(w) {
      return w.length===COLS && ANSWERS.includes(w);
    }

    function reveal(guess) {
      const tgt = target;
      const counts = {};
      for (const ch of tgt) counts[ch]=(counts[ch]||0)+1;

      // First pass: greens
      for (let c=0; c<COLS; c++) {
        if (guess[c]===tgt[c]) { meta[row][c]='g'; counts[guess[c]]--; }
      }
      // Second pass: yellows / grays
      for (let c=0; c<COLS; c++) {
        if (meta[row][c]) continue;
        const ch = guess[c];
        if (tgt.includes(ch) && counts[ch]>0) { meta[row][c]='y'; counts[ch]--; }
        else meta[row][c]='x';
      }

      // Update keyboard colors (priority g>y>x)
      for (let c=0; c<COLS; c++) {
        const ch = guess[c];
        const k = $('k-'+ch);
        if (!k) continue;
        if (meta[row][c]==='g') { k.classList.remove('k-yellow','k-gray'); k.classList.add('k-green'); }
        else if (meta[row][c]==='y' && !k.classList.contains('k-green')) { k.classList.add('k-yellow'); }
        else if (!k.classList.contains('k-green') && !k.classList.contains('k-yellow')) k.classList.add('k-gray');
      }

      draw();
      if (guess===tgt) { endGame(true); return; }
      row++; col=0;
      if (row===ROWS) endGame(false);
    }

    function endGame(win) {
      over = true;
      if (win) {
        toastMsg("Nice! You got it.");
        incrementStats(true, row);
        if (!freePlay) $('win-modal').classList.remove('hidden');
      }
      else {
        toastMsg("The word was '"+target+"'");
        incrementStats(false, ROWS);
        $('lose-word').textContent = target;
        $('lose-modal').classList.remove('hidden');
      }
      updateStatsUI();
    }

    function toastMsg(msg) {
      toast.textContent = msg; toast.classList.add('show');
      clearTimeout(window._t);
      window._t = setTimeout(()=>toast.classList.remove('show'), 1600);
    }

    // Stats
    function loadStats() {
      const d = JSON.parse(localStorage.getItem('wi-stats')||'{}');
      return { played:d.played||0, wins:d.wins||0, streak:d.streak||0, maxStreak:d.maxStreak||0, dist:d.dist||[0,0,0,0,0,0] };
    }
    function saveStats() { localStorage.setItem('wi-stats', JSON.stringify(stats)); }
    function incrementStats(win, tries) {
      stats.played++; if (win) { stats.wins++; stats.streak++; stats.maxStreak=Math.max(stats.maxStreak, stats.streak); stats.dist[tries-1]++; }
      else stats.streak=0;
      saveStats();
    }
    function updateStatsUI() {
      $('s-played').textContent = stats.played;
      $('s-win').textContent = stats.played ? Math.round(100*stats.wins/stats.played) : 0;
      $('s-streak').textContent = stats.streak;
    }

    // Share
    function buildShare() {
      let usedRows = over && grid[row]?.every(x=>x) ? row+1 : row;
      usedRows = Math.min(usedRows, ROWS);
      const lines = [];
      for (let r=0; r<usedRows; r++) {
        let line = "";
        for (let c=0; c<COLS; c++) {
          line += meta[r][c]==='g' ? '🟩' : meta[r][c]==='y' ? '🟨' : '⬛';
        }
        lines.push(line);
      }
      return "No ads, no registration, just Worlde. Play at tinyurl.com/WordleNoAds\n" + lines.join('\n');
    }

    async function doShare() {
      const text = buildShare();
      try {
        if (navigator.share) {
          await navigator.share({ text });
        } else {
          await navigator.clipboard.writeText(text);
          toastMsg("Result copied");
        }
      } catch(e) {
        toastMsg("Share failed");
      }
    }

    $('btn-share').addEventListener('click', doShare);
    $('btn-new').addEventListener('click', () => newGame());
    $('btn-free').addEventListener('click', () => $('free-modal').classList.remove('hidden'));
    $('free-start').addEventListener('click', () => { freePlay = true; $('free-modal').classList.add('hidden'); newGame(); });
    $('free-cancel').addEventListener('click', () => $('free-modal').classList.add('hidden'));
    $('intro-start').addEventListener('click', () => $('intro-modal').classList.add('hidden'));
    $('win-close').addEventListener('click', () => $('win-modal').classList.add('hidden'));
    $('win-share').addEventListener('click', doShare);
    $('lose-close').addEventListener('click', () => $('lose-modal').classList.add('hidden'));
    $('lose-share').addEventListener('click', doShare);

    function newGame() {
      target = freePlay ? pickRandomWord() : pickWord(); row=0; col=0; over=false;
      grid = Array.from({length: ROWS}, () => Array(COLS).fill(""));
      meta = Array.from({length: ROWS}, () => Array(COLS).fill(""));
      // reset keyboard color classes
      for (const ch of ALPH) {
        const k=$('k-'+ch); if (k) k.classList.remove('k-green','k-yellow','k-gray');
      }
      status.textContent = "";
      draw();
    }

    // Physical keyboard
    window.addEventListener('keydown', (e)=> {
      if (e.key==='Enter') enter();
      else if (e.key==='Backspace') backspace();
      else {
        const ch = e.key.toLowerCase();
        if (ALPH.includes(ch)) add(ch);
      }
    });

    // Initialize
    buildBoard(); buildKeyboard(); draw(); updateStatsUI();
    $('intro-modal').classList.remove('hidden');

  </script>
</body>
</html>
